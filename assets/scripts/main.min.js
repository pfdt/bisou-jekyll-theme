---
---
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js';import{getAuth,onAuthStateChanged,GoogleAuthProvider,signInWithPopup,signInWithRedirect,signOut,getRedirectResult}from'https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js';import{getDatabase,ref,onValue,query,startAt,orderByChild,equalTo,update}from'https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js';var
q,TIMEOUT_ID=0,activeSidebar=false,wideLayout=true,currentFilter,currentSort,currentSortOrder,currentBookmarks=':not(*)',currentUserID,latestFilter,jsonFeed,userPhotoURL;const
allowEmpty=false,disableBodyScroll=bodyScrollLock.disableBodyScroll,enableBodyScroll=bodyScrollLock.enableBodyScroll,jsonFeedUrl='/assets/feeds/search.json',firebase_apiKey={{site.data.tools.firebase.apiKey|jsonify}},firebase_projectId={{site.data.tools.firebase.projectId|jsonify}},firebase_databaseName={{site.data.tools.firebase.dbName|jsonify}},firebase_authDomain=firebase_projectId+'.firebaseapp.com',firebase_databaseURL=firebase_databaseName+'.firebaseio.com',firebase_storageBucket=firebase_projectId+'.appspot.com',signedIn_modalTitle={{site.data.content.account-modal_content.signed-in_title|jsonify}},signedIn_modalBody={{site.data.content.account-modal_content.signed-in_body|markdownify|jsonify}},signedIn_modalClose={{site.data.content.account-modal_content.signed-in_close|jsonify}},login_modalTitle={{site.data.content.account-modal_content.login_title|jsonify}},login_modalBody={{site.data.content.account-modal_content.login_body|markdownify|jsonify}},login_modalClose={{site.data.content.account-modal_content.login_close|jsonify}};$(document).ready(function(){var
$1em=parseFloat(getComputedStyle(document.body,null).fontSize);const
$htmlBody=$("html, body"),scrollTopOffset=$1em*6.3,wideLayoutBreakingpoint=$1em*35.5,$searchInput=$("#searchbar__input"),$emptySearch=$("#searchbar__empty-search"),$allMenuItems=$(".filter-button"),$gridContainer=$("#isotopeContent"),$bookmarksFilter=$("#filter-button--bookmarks"),$recipesAll=$("#filter-button--all-recipes"),$sidebar=document.querySelector('#sidebar'),$accountModal=document.querySelector('#account-modal');var lazyLoadInstance=new LazyLoad({thresholds:"500% 0px"});var $grid=$($gridContainer).isotope({itemSelector:'.grid-item',getSortData:{name:"[data-name]",date:"[data-date]",rating:"[data-rating]",},percentPosition:true,layoutMode:'fitRows',transitionDuration:0});var $items=$grid.find(".grid-item");$grid.addClass("showOn").isotope("revealItemElements",$items);document.addEventListener('ResizeObserverCompleted',function(){isotopeLayout();});detectHash();const firebaseConfig={apiKey:firebase_apiKey,authDomain:firebase_authDomain,databaseURL:firebase_databaseURL,storageBucket:firebase_storageBucket};const app=initializeApp(firebaseConfig);const db=getDatabase(app);const auth=getAuth(app);onAuthStateChanged(auth,(user)=>{if(user){currentUserID=user.uid;loadFirebaseDatas(user);}else{currentUserID=undefined;}});getThemePreference();async function initiateLazyLoad(){var lazyLoadInstance=new LazyLoad({elements_selector:".lazy",});}
async function isotopeLayout(){$grid.isotope('layout');}
async function detectHash(){var URLparam=location.search||"";if(URLparam!==""){getHashParam(URLparam);}else{defaultFilter();defaultSort();}}
function getHashParam(URLparam){getCurrentFilter(URLparam);getCurrentSort(URLparam);}
async function getCurrentFilter(URLparam){var paramCat=URLparam.match(/(\?(q|cat)=.*?(?=&|(?=$)))/g)[0]||"";var paramSearch=paramCat.includes("?q=");paramCat=paramCat.toString().replace("?cat=","").replace("?q=","")||"*";if(paramCat=="bookmarks"){var filterValue=currentBookmarks;currentFilter="cat="+paramCat;$bookmarksFilter.addClass("active");isotopeFilter(filterValue);}else if(paramSearch==true){currentFilter="q="+paramCat;let searchInput=decodeURIComponent(paramCat);$searchInput.val(searchInput);}else if(paramCat!=="all"){var filterValue=".c_"+paramCat;currentFilter="cat="+paramCat;$(".filter-button-group").find('[data-filter="'+filterValue+'"]').addClass("active");isotopeFilter(filterValue);}else{defaultFilter();}}
async function getCurrentSort(URLparam){var paramCat=URLparam.match(/(\?(q|cat)=.*?(?=&|(?=$)))/g)[0]||"";URLparam=URLparam.match(/(&sort=.*?(?=$))/g)||"";URLparam=URLparam.toString().replace("&sort=","");var sortOrder=URLparam.split("_")[1];var sort=URLparam.split("_")[0];currentSort=sort;if(sort!==""){if((sort=="name"&&sortOrder=="asc")||(sort!=="name"&&sortOrder!=="desc")){currentSortOrder="asc";}else{currentSortOrder="desc";}
isotopeSort();layoutCleanSort();}else if(paramCat=="?cat=latest"){latestFilter=true;currentSort="name";currentSortOrder="asc";isotopeSort('latestFilter');layoutCleanSort('latestFilter');}else{defaultSort();}}
async function defaultFilter(){currentFilter="cat=all";$recipesAll.addClass("active");}
async function defaultSort(){currentSort="name";currentSortOrder="asc";$("#sort-button--name").addClass("asc");}
async function loadFirebaseDatas(user){if(user){currentUserID=user.uid;userPhotoURL=user.photoURL;getFirebaseBookmarks(currentUserID);getFirebaseRatings(currentUserID);signedIn();getFirebaseAdminStatus(currentUserID);}else{currentUserID=undefined;signedOut();if(currentFilter=="cat=bookmarks"){modalON();}}}
async function getFirebaseBookmarks(currentUserID){const qFirebaseBookmarks=query(ref(db,currentUserID+'/recipes/'),orderByChild('bookmark'),equalTo(true));return onValue(qFirebaseBookmarks,(snapshot)=>{var filterValue=[];filterValue.push(":not(*)");snapshot.forEach(function(child){let recipe=child.key;$(".r_"+recipe+" .card__body__controls__bookmark").addClass("active");filterValue.push(".r_"+recipe);});filterValue=filterValue.toString();currentBookmarks=filterValue;$bookmarksFilter.attr("data-filter",filterValue);if(currentFilter=="cat=bookmarks"){isotopeFilter(filterValue);}},{onlyOnce:true})}
async function getFirebaseRatings(currentUserID){const qFirebaseRatings=query(ref(db,currentUserID+'/recipes/'),orderByChild('rating'),startAt(1));return onValue(qFirebaseRatings,(snapshot)=>{snapshot.forEach(function(child){let recipe=child.key;let rating=child.val().rating;$(".r_"+recipe).attr("data-rating",rating);$(".r_"+recipe+" .card__body__controls__rating").addClass("active").find(".rating__icons."+rating).addClass("active");});isotopeSortUpdate();},{onlyOnce:true})}
async function getFirebaseAdminStatus(currentUserID){const qFirebaseAdminStatus=query(ref(db,currentUserID+'/role'));return onValue(qFirebaseAdminStatus,(snapshot)=>{if(snapshot.val()=="admin"){$(".adminContent").addClass("active");}});}
const provider=new GoogleAuthProvider();function googleSignin(){auth.useDeviceLanguage();signInWithPopup(auth,provider).then((result)=>{const credential=GoogleAuthProvider.credentialFromResult(result);const token=credential.accessToken;const user=result.user;console.log('success');console.log(token);console.log(user);}).catch((error)=>{const errorCode=error.code;const errorMessage=error.message;const credential=GoogleAuthProvider.credentialFromError(error);console.log('error');console.log(errorCode);console.log(errorMessage);});}
function googleSignout(){signOut(auth).then(()=>{console.log("Déconnexion réussie");}).catch((error)=>{console.log("Échec de la déconnexion");});}
async function signedIn(){$('body').addClass("signed-in");$('.main-nav__icons--account').css('background-image',"url('"+userPhotoURL+"')");$('.main-nav__icons--account > path').css('opacity','0');$('.modal-title').html(signedIn_modalTitle);$('.modal-content__body').html(signedIn_modalBody);$('.modal-content__button .modal-off').html(signedIn_modalClose);}
async function signedOut(){$('body').removeClass('signed-in');$('.main-nav__icons--account').css('background-image','none');$('.main-nav__icons--account > path').css('opacity','1');$('.modal-title').html(login_modalTitle);$('.modal-content__body').html(login_modalBody);$('.modal-content__button .modal-off').html(login_modalClose);$('.adminContent').removeClass('active');currentBookmarks=':not(*)';}
async function getThemePreference(){currentTheme=localStorage.getItem('theme')?localStorage.getItem('theme'):null;if(currentTheme&&currentTheme==='dark'){$(".theme-switch input[type='checkbox']").prop("checked",true);}}
wideWindowDetector();$(window).resize(function(){wideWindowDetector();});$("#main-nav").on("click","#logo",function(){resetFilter();disableSidebarCondition();});$("#main-nav").on("click","#burger",function(){toggleBurger();});$("#main-nav").on("click","#account",function(){modalON();});$("#filter-button--specials").on("click","a",function(){filterSpecials($(this));});$("#filter-button--categories").on("click","a",function(){filterCategories($(this));});$("#filter-button--other-filters").on("click","a",function(){filterCategories($(this));});$("#sorting-button-group").on("click","li",function(){sortItems($(this));});$("#searchbar__form").on("click","#searchbar__empty-search",function(){resetFilter();});$(".card__body__controls").on("click",".card__body__controls__bookmark",function(){toggleBookmark($(this));});$(".card__body__controls").on("click",".rating__icons",function(){saveRating($(this));});$("#no-result").on("click","a",function(){resetFilter();});$(".modal-content__button").on("click","#button--signIn",function(){googleSignin();});$(".modal-content__button").on("click","#button--signOut",function(){googleSignout();signedOut();if(currentFilter=="cat=bookmarks"){resetFilter();}});$("#account-modal").on("click",".js-close-modal",function(){modalOFF();if(!currentUserID){resetFilter();}});$("body").on("click","#overlay--sidebar",function(){disableSidebar();});$("body").on("click","#overlay--modal",function(){modalOFF();if(!currentUserID){resetFilter();}});$(".theme-switch").on("change","input[type='checkbox']",function(){switchTheme($(this));});initSearch();$(document).ready(function(){preloadImages();});async function wideWindowDetector(){let newWideLayout=$(window).width()>wideLayoutBreakingpoint;if(newWideLayout!==wideLayout){if(activeSidebar==true){disableSidebar();}
wideLayout=!wideLayout;}}
async function toggleBurger(){if(activeSidebar==true){disableSidebar();}else{activateSidebar();}}
async function filterSpecials(link){if(link.is($recipesAll)){resetFilter();disableSidebarCondition();}else if(link.is($bookmarksFilter)){bookmarksFilter(link);}}
async function filterCategories(link){let activeFilter=link.hasClass("active");if(activeFilter==true&&wideLayout==false){disableSidebar();}else if(activeFilter==true&&wideLayout==true){resetFilter();}else{var filterValue=link.attr("data-filter");currentFilter="cat="+filterValue.replace(".c_","");layoutCleanFilter(link);layoutCleanSearch();if(currentFilter=="cat=latest"){latestFilter=true;isotopeFilter(filterValue,false,'date_desc');pushURL('latestFilter');}else if(latestFilter==true){latestFilter=false;isotopeFilter(filterValue,false,'resetLatestFilter');pushURL();}else{isotopeFilter(filterValue);pushURL();}
disableSidebarCondition();}}
async function bookmarksFilter(link){let activeFilter=link.hasClass("active");if(activeFilter==true&&wideLayout==false){disableSidebar();}else if(activeFilter==true&&wideLayout==true){resetFilter();}else{if(!currentUserID){modalON();}
currentFilter="cat=bookmarks";if(latestFilter==true){latestFilter=false;isotopeFilter(currentBookmarks,false,'resetLatestFilter');}else{isotopeFilter(currentBookmarks);}
layoutCleanFilter(link);layoutCleanSearch();pushURL();disableSidebarCondition();}}
async function resetFilter(){currentFilter="cat=all";latestFilter=false;layoutCleanFilter($recipesAll);layoutCleanSearch();isotopeFilter('*',false,'resetLatestFilter');pushURL();}
async function layoutCleanFilter(link){$allMenuItems.removeClass("active");link.addClass("active");}
async function layoutCleanSearch(){$($emptySearch).removeClass("active");$("#no-result").removeClass("active");$searchInput.val("");}
async function isotopeFilter(filterValue,noScrollTop,sortValue){if(sortValue&&sortValue=="date_desc"){$grid.isotope({filter:filterValue,sortBy:'date',sortAscending:false});layoutCleanSort('latestFilter');}else if(sortValue&&sortValue=="resetLatestFilter"){if(currentSortOrder=="asc"){var sortAscendingValue=true;}else{var sortAscendingValue=false;}
$grid.isotope({filter:filterValue,sortBy:currentSort,sortAscending:sortAscendingValue});layoutCleanSort();}else{$grid.isotope({filter:filterValue});}
if(!noScrollTop){$htmlBody.animate({scrollTop:0});}}
async function isotopeSort(option){if(option&&option=="latestFilter"){$grid.isotope({sortBy:'date',sortAscending:false});}else{if(currentSortOrder=="asc"){var sortAscendingValue=true;}else{var sortAscendingValue=false;}
$grid.isotope({sortBy:currentSort,sortAscending:sortAscendingValue});}}
async function isotopeSortUpdate(){$grid.isotope("updateSortData").isotope();}
function sortItems(sortButton){var sort=sortButton.attr("data-sorting");currentSort=sort;if((sort=="name"&&currentSortOrder=="asc")||(sort!=="name"&&currentSortOrder!=="desc")){currentSortOrder="desc";isotopeSort();}else{currentSortOrder="asc";isotopeSort();}
layoutCleanSort();pushURL();}
async function layoutCleanSort(option){$(".sort-button").removeClass("asc").removeClass("desc");if(option&&option=="latestFilter"){$("#sort-button--date").addClass("desc");}else{$("#sort-button--"+currentSort).addClass(currentSortOrder);}}
async function pushURL(option){if(option&&option=="latestFilter"){history.replaceState(null,"","/?"+currentFilter+"&sort=date_desc");}
else{history.replaceState(null,"","/?"+currentFilter+"&sort="+currentSort+"_"+currentSortOrder);}}
async function activateSidebar(){activeSidebar=true;$("body").addClass("activeSidebar");if(wideLayout==false){disableBodyScroll($sidebar);}}
async function disableSidebar(){activeSidebar=false;$("body").removeClass("activeSidebar");enableBodyScroll($sidebar);}
async function disableSidebarCondition(){if(wideLayout==false){disableSidebar();}}
function toggleBookmark(bookmark){if(currentUserID){var recipe=bookmark.attr("value");var path=currentUserID+"/recipes/"+recipe;const qToggleBookmark=query(ref(db,path));return onValue(qToggleBookmark,(snapshot)=>{var filterValue=currentBookmarks;if(snapshot.val()==null||snapshot.val().bookmark==false){bookmark.addClass("active");filterValue+=",.r_"+recipe;filterValue=filterValue.replace(/^,/,"").replace(",,",",");let data={bookmark:true};let updates={};updates[path]=data;update(ref(db),updates);}else{bookmark.removeClass("active");filterValue=filterValue.replace(".r_"+recipe,"").replace(",,",",").replace(/,$/,"").replace(/^,/,"");let data={bookmark:false};let updates={};updates[path]=data;update(ref(db),updates);}
currentBookmarks=filterValue;$bookmarksFilter.attr("data-filter",filterValue);if(currentFilter=="cat=bookmarks"){isotopeFilter(filterValue,true);}},{onlyOnce:true});}else{modalON();}}
function saveRating(ratingObject){if(currentUserID){var recipeObject=ratingObject.parent().closest(".card__body__controls__rating");var recipe=recipeObject.attr("value");var path=currentUserID+"/recipes/"+recipe;const qSaveRating=query(ref(db,path));return onValue(qSaveRating,(snapshot)=>{var stars=Number(ratingObject.attr("value"));if(snapshot.val()!==null&&snapshot.val().rating==stars){var stars=0;recipeObject.removeClass("active").find(".rating__icons").removeClass("active");}else{recipeObject.addClass("active").find(".rating__icons").removeClass("active");ratingObject.addClass("active");}
let data={rating:stars};let updates={};updates[path]=data;update(ref(db),updates);$(".r_"+recipe).attr("data-rating",stars);isotopeSortUpdate();},{onlyOnce:true});}else{modalON();}}
async function modalON(){$("#account-modal").addClass("show");$("body").addClass("modal-open");disableBodyScroll($accountModal);}
async function modalOFF(){$("#account-modal").removeClass("show");$("body").removeClass("modal-open");enableBodyScroll($accountModal);}
async function switchTheme(e){if(e.is(':checked')){document.documentElement.setAttribute('data-theme','dark');localStorage.setItem('theme','dark');}else{document.documentElement.setAttribute('data-theme','light');localStorage.setItem('theme','light');}}
async function initSearch(){getUpdatedJson();$searchInput.bind("input",function(e){clearTimeout(TIMEOUT_ID);q=$searchInput.val();if(q==""){resetFilter();}else{TIMEOUT_ID=setTimeout(function(){e.preventDefault();execSearch(q);},250);}});}
function getUpdatedJson(){$.getJSON(jsonFeedUrl,function(data){let rawJsonFeed=JSON.stringify(data).normalize("NFD").replace(/[\u0300-\u036f]/g,"");jsonFeed=JSON.parse(rawJsonFeed);getInitialSearch();});}
async function getInitialSearch(){q=$searchInput.val();if(q){execSearch(q);}}
function execSearch(q){if(q!=""||allowEmpty){getSearchResults();}}
function getSearchResults(){var searchValues=[];var resultsCount=0;q=q.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[\u2019]/g,"'");$.each(jsonFeed,function(index,item){let title=item.title||"";let ingredients=item.ingredients||"";let technique=item.technique||"";let category=item.category||"";let source=item.source||"";if(title.indexOf(q)>-1||ingredients.indexOf(q)>-1||technique.indexOf(q)>-1||category.indexOf(q)>-1||source.indexOf(q)>-1){let searchValue=item.data_search;resultsCount++;searchValues.push(searchValue);}});if(resultsCount>0){var filterValue=searchValues.join(", ");currentFilter="q="+encodeURIComponent(q);$("#no-result").removeClass("active");pushURL();}else{var filterValue=":not(*)";$("#no-result").addClass("active");}
layoutCleanFilter($emptySearch);isotopeFilter(filterValue,false,'resetLatestFilter');}
async function preloadImages(){var img=["{{ '/assets/img-static/alt_logo-icon.svg' }}","{{ '/assets/img-static/alt_star--borders.svg' }}","{{ '/assets/img-static/alt_star.svg' }}","{{ '/assets/img-static/alt_bookmark.svg' }}","{{ '/assets/img-static/alt_arrow--up.svg' }}","{{ '/assets/img-static/alt_arrow--down.svg' }}","{{ '/assets/img-static/alt_logo.svg' }}","{{ '/assets/img-static/alt_bookmarks.svg' }}","{{ '/assets/img-static/alt_star--dots.svg' }}","{{ '/assets/img-static/alt_bookmark--border.svg' }}","{{ '/assets/img-static/alt_sort--name.svg' }}","{{ '/assets/img-static/alt_sort--date.svg' }}","{{ '/assets/img-static/alt_sort--rating.svg' }}","{{ '/assets/img-static/logo-icon.svg' }}","{{ '/assets/img-static/star--borders.svg' }}","{{ '/assets/img-static/star.svg' }}","{{ '/assets/img-static/bookmark.svg' }}","{{ '/assets/img-static/arrow--up.svg' }}","{{ '/assets/img-static/arrow--down.svg' }}","{{ '/assets/img-static/logo.svg' }}","{{ '/assets/img-static/bookmarks.svg' }}","{{ '/assets/img-static/star--dots.svg' }}","{{ '/assets/img-static/bookmark--border.svg' }}","{{ '/assets/img-static/sort--name.svg' }}","{{ '/assets/img-static/sort--date.svg' }}","{{ '/assets/img-static/sort--rating.svg' }}"];for(let i=0;i<img.length;i++){$("head").append("<link rel='preload' href='"+img[i]+"' as='image'>");}}});